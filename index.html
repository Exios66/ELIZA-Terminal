<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI-Powered Terminal Emulator</title>
  <style>
    :root {
      --bg-color: #000;
      --text-color: #0f0;
      --prompt-color: #0f0;
      --highlight-color: #222;
    }

    body {
      margin: 0;
      font-family: monospace;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    #terminal {
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 10px;
      overflow-y: auto;
      box-sizing: border-box;
      white-space: pre-wrap;
    }

    .output {
      margin-bottom: 10px;
    }

    #input-line {
      display: flex;
      align-items: center;
    }

    #prompt {
      color: var(--prompt-color);
      margin-right: 5px;
      flex-shrink: 0;
    }

    #input {
      flex-grow: 1;
      background: none;
      border: none;
      color: inherit;
      outline: none;
      font-family: inherit;
      font-size: 1rem;
    }

    .theme-switcher {
      position: fixed;
      top: 10px;
      right: 10px;
      background: var(--highlight-color);
      color: var(--text-color);
      padding: 8px 12px;
      cursor: pointer;
      border: 1px solid var(--prompt-color);
      user-select: none;
      font-size: 0.9rem;
    }

    .hidden {
      display: none;
    }

    /* Basic scroll styling */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #333;
    }
    ::-webkit-scrollbar-thumb {
      background: #666;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #888;
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div class="output" id="welcome-message">
      Welcome to the AI-Powered Terminal Emulator!
      Type <strong>'help'</strong> to see available commands.
      Type <strong>'mode eliza'</strong> to switch to conversation mode.
    </div>
    <div id="input-line">
      <span id="prompt">$</span>
      <input id="input" type="text" autocomplete="off" autofocus />
    </div>
  </div>

  <!-- Theme Switcher Button -->
  <div class="theme-switcher" id="theme-switcher">Theme</div>

  <script>
    "use strict";

    class Terminal {
      constructor(outputContainer, inputField, promptElement) {
        this.outputContainer = outputContainer;
        this.inputField = inputField;
        this.promptElement = promptElement;

        // Current mode: "terminal" or "eliza"
        this.mode = "terminal";

        // Keep track of command history
        this.commandHistory = [];
        this.historyIndex = -1;

        // Setup blocked or restricted commands
        this.blockedCommands = ["rm -rf /", "curl", "wget"];

        // Define available themes
        this.themes = {
          classic:  { bg: "#000",      text: "#0f0" },
          light:    { bg: "#fafafa",  text: "#111" },
          dark:     { bg: "#111",      text: "#eee" },
          matrix:   { bg: "#000",      text: "#00ff00" },
          blue:     { bg: "#001f3f",   text: "#00aced" }
        };

        // Setup the Eliza conversation logic
        // This can be expanded into a more sophisticated pattern-based approach
        this.elizaResponses = {
          default:       ["Why do you say that?", "Can you elaborate?", "What makes you feel this way?"],
          feelings:      ["Tell me more about your feelings.", "Do you often feel this way?", "What triggers these emotions?"],
          relationships: ["How are your relationships?", "Is there someone important you'd like to talk about?", "Why do you think this person affects you?"],
          work:          ["How is work going for you?", "Do you feel satisfied with your work?", "What challenges are you facing at work?"],
          general:       ["Tell me more about that.", "Why do you think so?", "What does this mean to you?"]
        };

        // Attach event listeners
        this.init();
        // Load user theme preference if stored
        this.loadThemePreference();
      }

      init() {
        this.inputField.addEventListener("keydown", (event) => {
          // Handle Enter
          if (event.key === "Enter") {
            const command = this.inputField.value.trim();
            this.processCommand(command);
            this.inputField.value = "";
            this.commandHistory.push(command);
            this.historyIndex = this.commandHistory.length;
          }
          // Handle arrow keys for command recall
          else if (event.key === "ArrowUp") {
            if (this.historyIndex > 0) {
              this.historyIndex--;
              this.inputField.value = this.commandHistory[this.historyIndex];
            }
            event.preventDefault();
          }
          else if (event.key === "ArrowDown") {
            if (this.historyIndex < this.commandHistory.length - 1) {
              this.historyIndex++;
              this.inputField.value = this.commandHistory[this.historyIndex];
            } else {
              this.historyIndex = this.commandHistory.length;
              this.inputField.value = "";
            }
            event.preventDefault();
          }
        });
      }

      // Process each command
      processCommand(command) {
        if (!command) return;
        this.printOutput(`$ ${command}`);

        // Global exit command
        if (command === "exit") {
          this.printOutput("Session terminated. Refresh to start anew.");
          return;
        }

        // Switch modes
        if (command.startsWith("mode ")) {
          const [, modeName] = command.split(" ");
          this.switchMode(modeName);
          return;
        }

        // Switch themes
        if (command.startsWith("theme ")) {
          const [, themeName] = command.split(" ");
          this.switchTheme(themeName);
          return;
        }

        // In Eliza mode, handle conversation
        if (this.mode === "eliza") {
          this.runEliza(command);
          return;
        }

        // If normal terminal mode, parse terminal commands
        this.runTerminal(command);
      }

      switchMode(mode) {
        if (mode === "eliza") {
          this.mode = "eliza";
          this.printOutput("Switched to ELIZA conversation mode. Type 'mode terminal' to go back.");
        } else if (mode === "terminal") {
          this.mode = "terminal";
          this.printOutput("Switched to standard terminal mode.");
        } else {
          this.printOutput(`Invalid mode: ${mode}. Valid modes are: terminal, eliza`);
        }
      }

      // Expandable for multiple conversation branches
      runEliza(input) {
        let response = "";
        const low = input.toLowerCase();
        if (low.includes("feel")) {
          response = this.getRandomResponse(this.elizaResponses.feelings);
        } else if (low.includes("relationship") || low.includes("friend")) {
          response = this.getRandomResponse(this.elizaResponses.relationships);
        } else if (low.includes("work") || low.includes("job")) {
          response = this.getRandomResponse(this.elizaResponses.work);
        } else if (low.includes("love") || low.includes("hate") || low.includes("like")) {
          response = "Love and hate are powerful emotions. Tell me more about them.";
        } else {
          response = this.getRandomResponse(this.elizaResponses.default);
        }
        this.printOutput(`ELIZA: ${response}`);
      }

      getRandomResponse(arrayOfResponses) {
        return arrayOfResponses[Math.floor(Math.random() * arrayOfResponses.length)];
      }

      // Expanding terminal commands
      runTerminal(command) {
        // Check for blocked commands
        if (this.blockedCommands.some((blocked) => command.includes(blocked))) {
          this.printOutput(`Permission denied: executing '${command}' is not allowed.`);
          return;
        }

        switch (true) {
          case command === "help":
            this.printOutput(
              "Available Commands:\n" +
              "  help                Display this help text\n" +
              "  clear               Clear the terminal screen\n" +
              "  history             Show command history\n" +
              "  ls                  List files\n" +
              "  pwd                 Print working directory\n" +
              "  whoami              Display current user\n" +
              "  uname -a            Display system information\n" +
              "  date                Show current date/time\n" +
              "  df                  Show disk usage info\n" +
              "  uptime              Show system uptime\n" +
              "  cal                 Show calendar\n" +
              "  touch <file>        Create empty file\n" +
              "  mkdir <dir>         Create directory\n" +
              "  mode eliza          Switch to Eliza conversation mode\n" +
              "  mode terminal       Switch to standard terminal mode\n" +
              "  theme list          List available themes\n" +
              "  theme <name>        Switch to specific theme\n" +
              "  exit                Terminate this session"
            );
            break;

          case command === "clear":
            // Clear everything except the last input line
            this.clearTerminal();
            break;

          case command === "history":
            this.printOutput(this.commandHistory.join("\n"));
            break;

          case command === "ls":
            this.printOutput("Desktop  Documents  Downloads  Music  Pictures  Videos");
            break;

          case command === "pwd":
            this.printOutput("/home/user");
            break;

          case command === "whoami":
            this.printOutput("user");
            break;

          case command === "uname -a":
            this.printOutput("Linux localhost 5.4.0-42-generic x86_64");
            break;

          case command === "date":
            this.printOutput(new Date().toString());
            break;

          case command === "df":
            this.printOutput("Filesystem     1K-blocks     Used Available Use% Mounted on\n/dev/sda1      488281250 100000000  388281250  20% /");
            break;

          case command === "uptime":
            this.printOutput(" 10:24:10 up 5 days,  4:52,  3 users,  load average: 0.00, 0.01, 0.05");
            break;

          case command === "cal":
            // Example partial monthly calendar
            this.printOutput(
              "    January 2025   \n" +
              "Su Mo Tu We Th Fr Sa\n" +
              "      1  2  3  4\n" +
              " 5  6  7  8  9 10 11\n" +
              "12 13 14 15 16 17 18\n" +
              "19 20 21 22 23 24 25\n" +
              "26 27 28 29 30 31"
            );
            break;

          case command.startsWith("touch"):
            {
              const fileName = command.split(" ")[1];
              if (!fileName) {
                this.printOutput("No file specified. Usage: touch <filename>");
              } else {
                this.printOutput(`Created file: ${fileName}`);
              }
            }
            break;

          case command.startsWith("mkdir"):
            {
              const dirName = command.split(" ")[1];
              if (!dirName) {
                this.printOutput("No directory specified. Usage: mkdir <dirname>");
              } else {
                this.printOutput(`Created directory: ${dirName}`);
              }
            }
            break;

          default:
            this.printOutput(`bash: ${command.split(" ")[0]}: command not found`);
        }
      }

      // Clear output except for an optional welcome message
      clearTerminal() {
        // Remove all .output nodes except input-line
        const children = Array.from(this.outputContainer.childNodes);
        children.forEach((child) => {
          if (child.id !== "input-line") {
            this.outputContainer.removeChild(child);
          }
        });
      }

      // Switch to a theme, or list themes
      switchTheme(themeName) {
        if (themeName === "list") {
          this.printOutput(`Available themes: ${Object.keys(this.themes).join(", ")}`);
          return;
        }

        if (!this.themes[themeName]) {
          this.printOutput(`Invalid theme. Use 'theme list' to see available themes.`);
          return;
        }

        const { bg, text } = this.themes[themeName];
        document.documentElement.style.setProperty("--bg-color", bg);
        document.documentElement.style.setProperty("--text-color", text);

        // You can tweak prompt/highlight color if desired
        // e.g., set them relative to the main text color

        this.printOutput(`Switched to ${themeName} theme.`);
        // Save to localStorage for user preference
        this.saveThemePreference(themeName);
      }

      // Store chosen theme in localStorage
      saveThemePreference(themeName) {
        try {
          window.localStorage.setItem("preferredTheme", themeName);
        } catch (e) {
          // silently fail if localStorage is not available
        }
      }

      // Load the last-used theme from localStorage if available
      loadThemePreference() {
        try {
          const storedTheme = window.localStorage.getItem("preferredTheme");
          if (storedTheme && this.themes[storedTheme]) {
            this.switchTheme(storedTheme);
          }
        } catch (e) {
          // do nothing
        }
      }

      // Utility function to print output lines
      printOutput(message) {
        const outputDiv = document.createElement("div");
        outputDiv.className = "output";
        outputDiv.textContent = message;
        // Insert before the input line
        this.outputContainer.insertBefore(outputDiv, document.getElementById("input-line"));
        // Scroll to bottom
        this.outputContainer.scrollTop = this.outputContainer.scrollHeight;
      }
    }

    // Initialize Terminal instance
    const terminalElement = document.getElementById("terminal");
    const inputElement = document.getElementById("input");
    const promptElement = document.getElementById("prompt");
    const terminal = new Terminal(terminalElement, inputElement, promptElement);

    // Theme switcher button logic
    document.getElementById("theme-switcher").addEventListener("click", () => {
      // Present the user with a quick way to see theme list, for example
      terminal.switchTheme("list");
    });
  </script>
</body>
</html>